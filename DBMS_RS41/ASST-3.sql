use cricket_tournament;

CREATE TABLE PERSON (
	D_ID INT PRIMARY KEY,
	D_NAME VARCHAR(30),
	D_ADDR VARCHAR(15)
);

DROP TABLE PERSON;

CREATE TABLE CAR(
	REG_NO VARCHAR(10) PRIMARY KEY,
	MODEL VARCHAR(10),
	C_YEAR YEAR
);

CREATE TABLE ACCIDENT(
	REPORT_NO INT PRIMARY KEY,
	A_DATE DATE,
	LOCATION VARCHAR(30)
);



CREATE TABLE OWNS(
	D_ID INT,
	FOREIGN KEY(D_ID) references PERSON(D_ID),
	REG_NO VARCHAR(10),
	foreign key(REG_NO) references CAR(REG_NO)
);



CREATE TABLE PARTICIPATED(
   	REPORT_NO INT,
	REG_NO VARCHAR(10),
    D_ID INT,
	DAMAGE_AMOUNT INT, 
	primary key(D_ID,REPORT_NO,REG_NO),
	foreign key(D_ID) references PERSON(D_ID),
	foreign key(REG_NO) references CAR(REG_NO),
	foreign key (REPORT_NO) references ACCIDENT(REPORT_NO)
);

DROP TABLE PARTICIPATED;

INSERT INTO PERSON VALUES
(0,'JENSON BUTTON', 'UNIVERSITY ST'),
(1,'RUBENS BARRICHELLO', '1ST AVE'),
(2,'SEBASTIAN VETTLE', '1ST AVE'),
(3,'MARK WEBBER','1ST AVE'),
(4,'LEWIS HAMILTON','1ST AVE'),
(5,'FELIPE MASSA','UNIVERSITY ST');


INSERT INTO CAR VALUES
('SZM813','HONDA',2009),
('SZM814','TOYOTA',2009),
('SZM815','BMW',2009),
('SZM816','HONDA',2009),
('SZM817','HONDA',2008),
('SZM818','BMW',2008),
('SZM819','BMW',2008),
('SZM820','TOYOTA',2008);


INSERT INTO ACCIDENT VALUES
(1,'2008-04-13','MONZA'),
(2,'2008-07-22','INDIANAPOLIS'),
(3,'2008-07-22','INDIANAPOLIS'),
(4,'2008-07-22','NEW YORK'),
(5,'2008-07-27','NEW YORK'),
(6,'2009-01-27','HIGHLAND HEIGHTS'),
(7,'2009-02-15','HIGHLAND HEIGHTS');


INSERT INTO OWNS VALUES
(0,'SZM813'),
(1,'SZM814'),
(2,'SZM815'),
(3,'SZM816'),
(4,'SZM817'),
(5,'SZM818'),
(0,'SZM819'),
(4,'SZM820');


INSERT INTO PARTICIPATED VALUES
(1,'SZM813',0,4000),
(2,'SZM814',1,6000),
(3,'SZM815',4,6000),
(4,'SZM814',1,1000),
(5,'SZM817',4,6000),
(6,'SZM818',5,5000),
(7,'SZM819',0,5000),
(4,'SZM817',4,3000),
(5,'SZM813',0,4000),
(6,'SZM814',3,2000),
(7,'SZM814',1,1000),
(7,'SZM820',4,6000),
(7,'SZM813',3,4000);

SELECT * FROM PERSON;
SELECT * FROM CAR;
SELECT * FROM ACCIDENT;
SELECT * FROM OWNS;
SELECT * FROM PARTICIPATED;

#Query 3
UPDATE PARTICIPATED
SET DAMAGE_AMOUNT = 11000
WHERE REG_NO = 'SZM814'
AND REPORT_NO BETWEEN 1 AND 5;

select * FROM PARTICIPATED;


#Q4
SELECT COUNT(DISTINCT O.D_ID)  AS RESULT
FROM OWNS O
JOIN PARTICIPATED P ON O.REG_NO = P.REG_NO
JOIN ACCIDENT A ON P.REPORT_NO = A.REPORT_NO
WHERE YEAR(A.A_DATE) = 2008;

#Q5
SELECT A.REPORT_NO, A.A_DATE, A.LOCATION,P.DAMAGE_AMOUNT from PARTICIPATED P                    
JOIN ACCIDENT A ON P.REPORT_NO = A.REPORT_NO
WHERE D_ID = 3
AND YEAR(A.A_DATE) = 2009;  

